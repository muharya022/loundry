{% extends 'base.html' %}
{% block content %}
<div x-data="{ open: false, user: {} }" class="min-h-screen bg-gray-50 p-6">

  <h1 class="text-3xl font-bold text-blue-600 mb-6 text-center">Manajemen Akun</h1>

  <!-- Tombol Tambah -->
  <div class="flex justify-end mb-4 gap-2">
    <a href="{% url 'accounts:add_user' %}" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
      + Tambah Member
    </a>
    <a href="{% url 'accounts:add_courier' %}" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 shadow transition">
      + Kurir
    </a>
  </div>

  <!-- Bagian Karyawan (Admin & Kurir) -->
  <div class="bg-white p-6 rounded-xl shadow-md overflow-x-auto mb-8">
    <h2 class="text-2xl font-semibold text-gray-700 mb-4">Karyawan (Admin & Kurir)</h2>
    <table class="min-w-full border border-gray-200 rounded-lg">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-4 py-2 text-left">ID</th>
          <th class="px-4 py-2 text-left">Username</th>
          <th class="px-4 py-2 text-left">Email</th>
          <th class="px-4 py-2 text-left">Role</th>
          <th class="px-4 py-2 text-center">Aksi</th>
        </tr>
      </thead>
      <tbody>
        {% for u in users_data %}
          {% if u.is_staff or u.is_courier %}
          <tr class="border-t hover:bg-blue-50 transition">
            <td class="px-4 py-2">{{ u.id }}</td>
            <td class="px-4 py-2">{{ u.username }}</td>
            <td class="px-4 py-2">{{ u.email }}</td>
            <td class="px-4 py-2">{% if u.is_staff %}Admin{% else %}Kurir{% endif %}</td>
            <td class="px-4 py-2 text-center flex justify-center gap-2">
              <!-- Tombol Detail -->
              <button 
                @click="user = {
                  id: '{{ u.id }}',
                  username: '{{ u.username|escapejs }}',
                  first_name: '{{ u.first_name|escapejs }}',
                  last_name: '{{ u.last_name|escapejs }}',
                  email: '{{ u.email|escapejs }}',
                  role: '{{ u.is_staff|yesno:'Admin,Kurir' }}',
                }; open = true"
                class="flex items-center gap-1 bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-md text-xs transition"
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                </svg>
                Detail
              </button>

              <!-- Tombol Hapus -->
              <form action="{% url 'accounts:delete_user' u.id %}" method="post" class="inline">
                {% csrf_token %}
                <button type="submit" onclick="return confirm('Yakin ingin menghapus pengguna ini?')" 
                  class="flex items-center gap-1 bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-md text-xs transition">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5-4h4a1 1 0 011 1v1H9V4a1 1 0 011-1z" />
                  </svg>
                  Hapus
                </button>
              </form>
            </td>
          </tr>
          {% endif %}
        {% empty %}
        <tr>
          <td colspan="5" class="text-center py-4 text-gray-500">Belum ada karyawan.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Bagian Member -->
  <div class="bg-white p-6 rounded-xl shadow-md overflow-x-auto">
    <h2 class="text-2xl font-semibold text-gray-700 mb-4">Member</h2>
    <table class="min-w-full border border-gray-200 rounded-lg">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-4 py-2 text-left">ID</th>
          <th class="px-4 py-2 text-left">Username</th>
          <th class="px-4 py-2 text-left">Email</th>
          <th class="px-4 py-2 text-center">Aksi</th>
        </tr>
      </thead>
      <tbody>
        {% for u in users_data %}
          {% if not u.is_staff and not u.is_courier %}
          <tr class="border-t hover:bg-blue-50 transition">
            <td class="px-4 py-2">{{ u.id }}</td>
            <td class="px-4 py-2">{{ u.username }}</td>
            <td class="px-4 py-2">{{ u.email }}</td>
            <td class="px-4 py-2 text-center flex justify-center gap-2">
                <!-- Tombol Detail -->
              <button 
                @click="user = {
                  id: '{{ u.id }}',
                  username: '{{ u.username|escapejs }}',
                  first_name: '{{ u.first_name|escapejs }}',
                  last_name: '{{ u.last_name|escapejs }}',
                  email: '{{ u.email|escapejs }}',
                  role: `{% if u.is_staff %}Admin{% elif u.is_courier %}Kurir{% else %}Member{% endif %}`,
                }; open = true"
                class="flex items-center gap-1 bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-md text-xs transition"
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                </svg>
                Detail
              </button>

              <!-- Tombol Hapus -->
              <form action="{% url 'accounts:delete_user' u.id %}" method="post" class="inline">
                {% csrf_token %}
                <button type="submit" onclick="return confirm('Yakin ingin menghapus pengguna ini?')" 
                  class="flex items-center gap-1 bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-md text-xs transition">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5-4h4a1 1 0 011 1v1H9V4a1 1 0 011-1z" />
                  </svg>
                  Hapus
                </button>
              </form>
            </td>
          </tr>
          {% endif %}
        {% empty %}
        <tr>
          <td colspan="4" class="text-center py-4 text-gray-500">Belum ada member.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Modal Detail User -->
  <div x-cloak x-show="open" x-transition
       @click.away="open=false"
       class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-xl w-96 relative">
      <button @click="open=false" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800">&times;</button>
      <h2 class="text-2xl font-bold mb-4">Detail User</h2>

      <div class="space-y-2">
        <p><strong>ID:</strong> <span x-text="user.id"></span></p>
        <p><strong>Username:</strong> <span x-text="user.username"></span></p>
        <p><strong>Nama Depan:</strong> <span x-text="user.first_name"></span></p>
        <p><strong>Nama Belakang:</strong> <span x-text="user.last_name"></span></p>
        <p><strong>Email:</strong> <span x-text="user.email"></span></p>
        <p><strong>Role:</strong> <span x-text="user.role"></span></p>
      </div>

      <div class="mt-4 text-right">
        <button @click="open=false" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md">Tutup</button>
      </div>
    </div>
  </div>

</div>

<!-- Alpine.js & x-cloak CSS -->
<script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
<style>
  [x-cloak] { display: none !important; }
</style>
{% endblock %}
