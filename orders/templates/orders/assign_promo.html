{% extends "base.html" %}
{% load widget_tweaks %}
{% load humanize %}

{% block content %}

<div class="min-h-screen bg-gradient-to-br from-blue-50 to-blue-100 py-10 px-4">
  <div class="max-w-6xl mx-auto space-y-10">

    <!-- ================= ASSIGN PROMO ================= -->
    <div class="bg-white rounded-2xl shadow-lg p-8 border border-blue-100">
      <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4 mb-6">
        <h3 class="text-2xl font-bold text-blue-700">Berikan Promo ke User</h3>

        <div class="flex gap-2">
          <a href="{% url 'orders:add_promo' %}"
             class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-xl transition text-sm">
             + Tambah Promo
          </a>
        </div>
      </div>

      <form method="post" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        {% csrf_token %}

        {% for field in form %}
        <div class="{% if forloop.last %}md:col-span-2{% endif %}">
          <label class="block text-gray-700 font-semibold mb-1">
            {{ field.label }}
          </label>
          {{ field|add_class:"w-full border border-gray-300 rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400" }}

          {% if field.help_text %}
            <p class="text-gray-500 text-xs mt-1">{{ field.help_text }}</p>
          {% endif %}

          {% for error in field.errors %}
            <p class="text-red-500 text-xs mt-1">{{ error }}</p>
          {% endfor %}
        </div>
        {% endfor %}

        <div class="md:col-span-2 flex gap-3 mt-4">
          <button type="submit"
                  class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-xl transition">
            Simpan
          </button>
          <a href="{% url 'orders:promo_assign' %}"
             class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-6 py-2 rounded-xl transition">
            Kembali
          </a>
        </div>
      </form>
    </div>

    <!-- ================= DAFTAR PROMO ================= -->
    <div class="bg-white rounded-2xl shadow-lg p-8 border border-blue-100">
      <div class="flex justify-between items-center mb-6">
        <div>
          <h2 class="text-2xl font-bold text-blue-700">Daftar Promo</h2>
          <p class="text-gray-500 text-sm">Promo yang tersedia untuk customer</p>
        </div>
      </div>

      <div class="overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead>
            <tr class="bg-blue-600 text-white">
              <th class="py-3 px-4 text-left">Judul</th>
              <th class="py-3 px-4">Diskon</th>
              <th class="py-3 px-4">Min. Transaksi</th>
              <th class="py-3 px-4 text-center">Status</th>
              <th class="py-3 px-4 text-center">Aksi</th>
            </tr>
          </thead>
          <tbody class="divide-y">
            {% for promo in promos %}
            <tr class="hover:bg-blue-50">
              <td class="py-3 px-4 font-medium">{{ promo.title }}</td>
              <td class="py-3 px-4">
                <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs">
                  {{ promo.discount }}%
                </span>
              </td>
              <td class="py-3 px-4">Rp {{ promo.min_transaction|intcomma }}</td>
              <td class="py-3 px-4 text-center">
                {% if promo.is_active %}
                  <span class="bg-green-100 text-green-700 px-2 py-1 rounded-full text-xs">Aktif</span>
                {% else %}
                  <span class="bg-gray-200 text-gray-700 px-2 py-1 rounded-full text-xs">Nonaktif</span>
                {% endif %}
              </td>
              <td class="py-3 px-4 text-center">
                <div class="flex justify-center gap-2">
                  <a href="{% url 'orders:promo_edit' promo.id %}"
                    class="bg-blue-500 text-white px-3 py-1 rounded text-xs">
                    ‚úèÔ∏è
                  </a>
                  <form action="{% url 'orders:promo_delete' promo.id %}" method="post">
                    {% csrf_token %}
                    <button onclick="return confirm('Hapus promo ini?')"
                      class="bg-red-500 text-white px-3 py-1 rounded text-xs">
                      üóëÔ∏è
                    </button>
                  </form>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>

{% endblock %}
